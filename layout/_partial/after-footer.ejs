<!-- jQuery -->
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

<!-- Other scripts -->
<script src="<%- url_for('js/jquery-1.4.3.min.js') %>"></script>
<% if (theme.fancybox){ %>
  <script src="<%- url_for('fancybox/jquery.fancybox-1.3.4.pack.js') %>"></script>
  <% } %>

    <script defer src="<%- url_for('js/script.js') %>"></script>
    <script defer src="<%- url_for('js/clipboard.min.js') %>"></script>

        <%- partial('gauges-analytics') %>

          <!-- Dark Mode Toggle -->
          <script>
            (function() {
              var darkMode = localStorage.getItem('dark_mode');
              if (darkMode === null) {
                darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
              } else {
                darkMode = darkMode === 'true';
              }
              if (darkMode) document.documentElement.classList.add('dark-mode');

              window.toggleDarkMode = function() {
                darkMode = !darkMode;
                document.documentElement.classList.toggle('dark-mode', darkMode);
                localStorage.setItem('dark_mode', darkMode);
              };
            })();
          </script>

          <!-- Language Switch -->
          <script>
            let currentLang = localStorage.getItem('blog_language') || ((navigator.language || '').startsWith('zh') ? 'zh' : 'en');

            document.addEventListener('DOMContentLoaded', function () {
              // 检查是否在首页
              const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
              const switchBtn = document.querySelector('.lang-switch');

              if (switchBtn) {
                // 只在首页显示语言切换按钮
                if (isHomePage) {
                  switchBtn.style.display = '';
                  updateLanguageDisplay();
                  updateSwitchButton();
                } else {
                  switchBtn.style.display = 'none';
                }
              }
            });

            function switchLanguage() {
              // 先切换语言
              currentLang = currentLang === 'zh' ? 'en' : 'zh';
              localStorage.setItem('blog_language', currentLang);

              // 更新按钮文本
              updateSwitchButton();

              // 最后更新显示
              updateLanguageDisplay();
            }

            function updateLanguageDisplay() {
              document.querySelectorAll('.archive-article').forEach(article => {
                const articleLang = article.getAttribute('data-lang');
                if (articleLang === currentLang) {
                  article.style.display = '';
                } else {
                  article.style.display = 'none';
                }
              });
            }

            function updateSwitchButton() {
              const switchBtn = document.querySelector('.lang-switch');
              if (switchBtn) {
                switchBtn.textContent = currentLang === 'zh' ? 'EN' : '中文';
              }
            }
          </script>