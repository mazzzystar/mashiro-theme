<head>
  <!-- DNS 预解析 -->
  <link rel="dns-prefetch" href="//mazzzystar.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">

  <!-- 预连接 -->
  <link rel="preconnect" href="https://mazzzystar.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Google Fonts: Gentium Plus (English serif) + Fira Code (monospace) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Gentium+Plus:ital,wght@0,400;0,700;1,400;1,700&family=Fira+Code:wght@400;500&display=swap">

  <!-- Google Analytics -->
  <% if (theme.google_analytics){ %>
    <script async src="https://www.googletagmanager.com/gtag/js?id=<%= theme.google_analytics %>"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', '<%= theme.google_analytics %>', {
        'send_page_view': true,
        'cookie_flags': 'secure;samesite=none',
        'transport_type': 'beacon'
      });
    </script>
    <% } %>

      <!-- 预加载关键资源 -->
      <link rel="preload" href="/css/style.css" as="style">
      <link rel="preload" href="/js/jquery.min.js" as="script">

      <!-- 预加载首屏字体子集，其他字体懒加载 -->
      <link rel="preload" href="/fonts/subsets/HYShuSongErS-tier1.woff2" as="font" type="font/woff2" crossorigin>
      <link rel="stylesheet" href="/css/font-subset.css">

      <!-- 条件加载 MathJax -->
      <% if (page.mathjax) { %>
        <link rel="preload" href="/js/mathjax/tex-mml-chtml.js" as="script">
        <% } %>

          <!-- Preload fonts -->
          <link rel="preload" href="/fonts/FZKTJW.woff2" as="font" type="font/woff2" crossorigin>
          <link rel="preload" href="/fonts/FZHTJW.woff2" as="font" type="font/woff2" crossorigin>
          <link rel="preload" href="/fonts/fontawesome-webfont.woff2" as="font" type="font/woff2" crossorigin>
          <!-- GowunDodum removed, using Gentium Plus from Google Fonts -->

          <!-- FontAwesome -->
          <link rel="stylesheet" href="/css/fontawesome.css">

          <meta charset="utf-8">
          <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
          <meta name="robots" content="index,follow">

          <!-- RSS Feed -->
          <% if (config.feed && config.feed.path) { %>
            <link rel="alternate" type="application/atom+xml" title="<%= config.title %>"
              href="<%- url_for(config.feed.path) %>">
            <% } else if (theme.rss) { %>
              <%- feed_tag(theme.rss) %>
                <% } %>

                  <% var title='' ; if (is_archive()){ title='Archives' ; if (is_month()){ title +=': ' + page.year
                    + '/' + page.month; } else if (is_year()){ title +=': ' + page.year; } } else if (is_category()){
                    title='Category: ' + page.category; } else if (is_tag()){ title='Tag: ' + page.tag; } else if
                    (page.title) { title=page.title; } else { title=config.title; } var description='' ; if
                    (page.description) { description=page.description; } else if (page.excerpt) {
                    description=strip_html(page.excerpt); } else if (page.content) {
                    description=strip_html(page.content); } else { description=config.description; }
                    description=description.substring(0, 150).trim(); var keywords='' ; if (page.keywords) {
                    keywords=page.keywords; } else if (page.tags && page.tags.length) {
                    keywords=page.tags.map(function(tag) { return tag.name; }).join(','); } function getFullUrl(path) {
                    if (path.startsWith('http')) return path; return config.url + (path.startsWith('/') ? '' : '/' ) +
                    path; } var image=page.cover_image || config.default_image || '/favicon.jpg' ; var
                    fullImageUrl=getFullUrl(image); var pageUrl=getFullUrl(page.path); let currentLocale=page.lang ||
                    page.language || config.language || 'en' ; if (currentLocale==='zh' ) currentLocale='zh_CN' ; else
                    if (currentLocale==='en' ) currentLocale='en_US' ; else if (currentLocale.includes('-'))
                    currentLocale=currentLocale.replace('-', '_' ); else currentLocale=currentLocale + '_' +
                    currentLocale.toUpperCase(); %>

                    <title>
                      <%= title %>
                    </title>
                    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
                    <meta name="author" content="<%= config.author %>">
                    <% if (is_home()) { %>
                      <meta name="description"
                        content="Personal blog of Ke Fang featuring articles on AI, technology, and personal thoughts in both English and Chinese.">
                      <% } else if (page.description) { %>
                        <meta name="description" content="<%= page.description %>">
                        <% } else if (page.excerpt) { %>
                          <meta name="description"
                            content="<%= strip_html(page.excerpt).replace(/^\s*/, '').replace(/\s*$/, '').substring(0, 150) %>">
                          <% } else if (page.content) { %>
                            <meta name="description"
                              content="<%= strip_html(page.content).replace(/^\s*/, '').replace(/\s*$/, '').substring(0, 150) %>">
                            <% } %>
                              <% if (keywords) { %>
                                <meta name="keywords" content="<%= keywords %>">
                                <% } %>

                                  <!-- <link rel="canonical" href="<%= pageUrl %>"> -->
                                  <link rel="canonical"
                                    href="<%= config.url %><%= url_for(page.path).replace('index.html', '') %>">

                                  <!-- Open Graph -->

                                  <meta property="og:type" content="<%= is_post() ? 'article' : 'website' %>">
                                  <meta property="og:title" content="<%= title %>">
                                  <meta property="og:url" content="<%= pageUrl %>">
                                  <meta property="og:image" content="<%= fullImageUrl %>">
                                  <meta property="og:description" content="<%= description %>">
                                  <meta property="og:site_name" content="<%= config.title %>">
                                  <meta property="og:locale"
                                    content="<% if (config.language === 'zh') { %>zh_CN<% } else { %>en_US<% } %>">
                                  <meta property="article:author" content="<%= config.author %>">
                                  <% if (keywords) { %>
                                    <meta property="article:tag" content="<%= keywords %>">
                                    <% } %>

                                      <% if (is_post()) { %>
                                        <meta property="article:published_time"
                                          content="<%= page.date.toISOString() %>">
                                        <% if (page.updated) { %>
                                          <meta property="article:modified_time"
                                            content="<%= page.updated.toISOString() %>">
                                          <% } %>
                                            <% } %>

                                              <!-- Twitter Card -->
                                              <meta name="twitter:card" content="summary_large_image">
                                              <meta name="twitter:title" content="<%= title %>">
                                              <meta name="twitter:description" content="<%= description %>">
                                              <meta name="twitter:image" content="<%= fullImageUrl %>">

                                              <!-- Stylesheets -->
                                              <link rel="stylesheet" href="/css/style.css">
                                              <link rel="stylesheet" href="/fancybox/jquery.fancybox-1.3.4.css">

                                              <!-- Scripts -->
                                              <script src="/js/jquery.min.js"></script>
                                              <script src="/fancybox/jquery.mousewheel-3.0.4.pack.js"></script>
                                              <script src="/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
                                              <script src="/js/script.js"></script>
                                              <script src="/js/clipboard.min.js"></script>

                                              <% if (theme.fancybox){ %>
                                                <link rel="stylesheet"
                                                  href="<%- url_for('fancybox/jquery.fancybox-1.3.4.css', {relative: true}) %>">
                                                <% } %>

                                                  <!-- MathJax Configuration -->
                                                  <script>
                                                    window.MathJax = {
                                                      tex: {
                                                        inlineMath: [['$', '$'], ['\\(', '\\)']],
                                                        displayMath: [['$$', '$$'], ['\\[', '\\]']],
                                                        processEscapes: true
                                                      },
                                                      options: {
                                                        enableMenu: false
                                                      },
                                                      startup: {
                                                        ready: () => {
                                                          MathJax.startup.defaultReady();
                                                        }
                                                      },
                                                      loader: {
                                                        load: ['[tex]/ams']
                                                      }
                                                    };
                                                  </script>
                                                  <script id="MathJax-script" defer
                                                    src="/js/mathjax/tex-mml-chtml.js"></script>

                                                  <!-- Structured Data -->
                                                  <% if (is_post()) { %>
                                                    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "<%= pageUrl %>"
      },
      "headline": "<%= title %>",
      "description": "<%= description %>",
      "author": {
        "@type": "Person",
        "name": "<%= config.author %>"
      },
      "datePublished": "<%= page.date.toISOString() %>",
      "dateModified": "<%= page.updated ? page.updated.toISOString() : page.date.toISOString() %>",
      "keywords": "<%= keywords %>",
      "image": "<%= fullImageUrl %>",
      "publisher": {
        "@type": "Organization",
        "name": "<%= config.title %>",
        "logo": {
          "@type": "ImageObject",
          "url": "<%= getFullUrl('favicon.jpg') %>"
        }
      }
    }
    </script>
                                                    <% } %>

                                                      <!-- Font Loader for Progressive Font Loading -->
                                                      <script defer src="/js/font-loader.js"></script>

                                                      <!-- Gowun Dodum CSS removed, using Gentium Plus -->

                                                      <!-- Language switcher styling -->
                                                      <style>
                                                        .lang-switch {
                                                          display: inline-block;
                                                          color: #555;
                                                          text-decoration: none !important;
                                                          font-weight: bold;
                                                          padding: 3px 8px;
                                                          border-radius: 4px;
                                                          transition: background-color 0.2s ease;
                                                        }

                                                        .lang-switch:hover {
                                                          background-color: #f0f0f0;
                                                          color: #333;
                                                          text-decoration: none !important;
                                                        }
                                                      </style>
</head>